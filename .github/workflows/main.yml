name: Metrics

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:
  push:
    branches: ["master", "main"]

concurrency:
  group: metrics-${{ github.ref }}
  cancel-in-progress: true

jobs:
  github-metrics:
    runs-on: ubuntu-22.04
    environment:
      name: production
    permissions:
      contents: write

    steps:
      - name: Generate brutalist textmode metrics
        uses: lowlighter/metrics@v3.34
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: humanbydefinition
          filename: github-metrics.svg

          template: terminal
          base: header, repositories
          config_timezone: Europe/Berlin
          config_order: base.header, languages, repositories, lines

          # --- Plugins ---
          plugin_languages: yes
          plugin_languages_sections: most-used
          plugin_languages_ignored: >-
            html, css
          plugin_languages_details: bytes-size, percentage

          plugin_repositories: yes
          plugin_repositories_pinned: 4
          plugin_lines: yes

          # --- Styling ---
          extras_css: |
            /* =========================================================
               Font: Bescii-Mono (Codeberg)
               ========================================================= */

            @font-face {
              font-family: "Bescii Mono";
              src:
                url("https://codeberg.org/Dmian/font-bescii/raw/branch/main/fonts/v3/Bescii-Mono.woff2") format("woff2"),
                url("https://codeberg.org/Dmian/font-bescii/raw/branch/main/fonts/v3/Bescii-Mono.woff") format("woff"),
                url("https://codeberg.org/Dmian/font-bescii/raw/branch/main/fonts/v3/Bescii-Mono.ttf") format("truetype");
              font-weight: 400;
              font-style: normal;
              font-display: swap;
            }

            /* =========================================================
               Terminal body — force Bescii on ALL SVG text
               ========================================================= */

            svg text,
            svg tspan {
              font-family: "Bescii Mono", ui-monospace, SFMono-Regular,
                           Menlo, Monaco, Consolas, "Liberation Mono",
                           "Courier New", monospace;
              letter-spacing: 0.08em;
            }

            /* Slightly tighter for bitmap-style fonts */
            svg text {
              dominant-baseline: middle;
            }

            /* =========================================================
               Header / window bar — keep UI font (fixes icon alignment)
               ========================================================= */

            header,
            header * {
              font-family: system-ui, -apple-system, BlinkMacSystemFont,
                           "Segoe UI", sans-serif !important;
              letter-spacing: 0 !important;
            }

            /* Ensure header glyphs stay centered */
            header text,
            header tspan {
              dominant-baseline: middle;
              alignment-baseline: middle;
            }

            /* =========================================================
               Brutalist framing
               ========================================================= */

            h1, h2, h3 {
              text-transform: uppercase;
            }

            h1 {
              font-size: 1.2em;
            }

            .items, .row, .column {
              border: 1px solid #ffffff22;
            }
