name: Metrics

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:
  push:
    branches: ["master", "main"]

concurrency:
  group: metrics-${{ github.ref }}
  cancel-in-progress: true

jobs:
  github-metrics:
    # Critical: ubuntu-latest is now 24.04; released Metrics image can fail building there.
    runs-on: ubuntu-22.04
    environment:
      name: production
    permissions:
      contents: write

    steps:
      - name: Generate brutalist textmode metrics
        uses: lowlighter/metrics@v3.34
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: humanbydefinition
          filename: github-metrics.svg
          template: terminal
          base: header, repositories
          config_timezone: Europe/Berlin
          config_order: base.header, languages, repositories, lines

          plugin_languages: yes
          plugin_languages_sections: most-used
          plugin_languages_ignored: >-
            html, css
          plugin_languages_details: bytes-size, percentage

          plugin_repositories: yes
          plugin_repositories_pinned: 4

          plugin_lines: yes

          extras_css: |
            /* Monospace, grid-y, terminal-ish */
            svg {
              font-family: "JetBrains Mono", "Fira Code", Consolas, Menlo, monospace;
              letter-spacing: 0.08em;
            }

            h1, h2, h3 {
              text-transform: uppercase;
            }

            /* Slightly chunkier headings */
            h1 {
              font-size: 1.2em;
            }

            /* Subtle borders for a brutalist card feel */
            .items, .row, .column {
              border: 1px solid #ffffff22;
            }
